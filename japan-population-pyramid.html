<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Japan Population Pyramid 1965–2070</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#fff;color:#1a1a1a;font-family:"IBM Plex Sans",sans-serif;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:40px 20px 60px}
h1{font-size:24px;font-weight:700;text-align:center;margin-bottom:4px}
h1 .accent{color:#d03025}
.subtitle{font-size:12px;color:#999;text-align:center;margin-bottom:24px}
.year-display{font-family:"JetBrains Mono";font-size:72px;font-weight:700;color:#eee;text-align:center;line-height:1;margin-bottom:-10px;user-select:none;transition:color 0.3s}
.year-display.future{color:#fde8e4}
.controls{display:flex;align-items:center;gap:16px;margin-bottom:20px;width:100%;max-width:800px}
.controls label{font-size:12px;color:#888;white-space:nowrap}
.controls input[type=range]{flex:1;height:6px;-webkit-appearance:none;background:#eee;border-radius:3px;outline:none}
.controls input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:#d03025;cursor:pointer;border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,0.2)}
.play-btn{background:#d03025;color:#fff;border:none;border-radius:8px;padding:8px 16px;font-size:13px;font-family:"IBM Plex Sans";font-weight:600;cursor:pointer;transition:background 0.2s;white-space:nowrap}
.play-btn:hover{background:#b02018}
.chart-container{position:relative;width:100%;max-width:800px}
svg{display:block;margin:0 auto}
.axis text{font-size:11px;fill:#888;font-family:"IBM Plex Sans"}
.axis line,.axis path{stroke:#e0e0e0}
.age-label{font-size:11px;fill:#666;font-family:"IBM Plex Sans";font-weight:500}
.legend{display:flex;gap:24px;justify-content:center;margin-top:16px}
.legend-item{display:flex;align-items:center;gap:6px;font-size:12px;color:#888}
.legend-dot{width:12px;height:12px;border-radius:3px}
.stats{display:flex;gap:32px;justify-content:center;margin-top:20px;flex-wrap:wrap}
.stat{text-align:center}
.stat-value{font-family:"JetBrains Mono";font-size:22px;font-weight:600;color:#1a1a1a}
.stat-label{font-size:11px;color:#aaa;margin-top:2px}
.source{font-size:10px;color:#ccc;text-align:center;margin-top:24px}
</style>
</head>
<body>

<h1>Japan <span class="accent">Population Pyramid</span></h1>
<div class="subtitle">Demographic shift from 1965 to 2070 — drag the slider or press Play</div>

<div class="year-display" id="yearDisplay">1965</div>

<div class="controls">
  <label>1965</label>
  <input type="range" id="yearSlider" min="0" max="21" value="0" step="1">
  <label>2070</label>
  <button class="play-btn" id="playBtn">▶ Play</button>
</div>

<div class="chart-container" id="chart"></div>

<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:#4a90d9"></div>Male</div>
  <div class="legend-item"><div class="legend-dot" style="background:#d04a5a"></div>Female</div>
</div>

<div class="stats" id="stats"></div>

<div class="source">Source: Statistics Bureau of Japan (Census) and National Institute of Population and Social Security Research "Population Projections for Japan (2023 Revision)" — Medium fertility, medium mortality variant.</div>

<script>
const ageLabels = ["0–4","5–9","10–14","15–19","20–24","25–29","30–34","35–39","40–44","45–49","50–54","55–59","60–64","65–69","70–74","75–79","80–84","85–89","90+"];

const years = [1965,1970,1975,1980,1985,1990,1995,2000,2005,2010,2015,2020,2025,2030,2035,2040,2045,2050,2055,2060,2065,2070];

const data = {
1965:{m:[4149.6,3995.0,4670.2,5478.3,4496.3,4157.0,4147.3,3747.5,2729.7,2224.6,2172.9,1930.5,1625.1,1218.9,789.0,451.9,186.9,60.1,13.7],f:[3983.9,3854.3,4513.2,5373.5,4572.4,4206.8,4110.1,3751.0,3231.7,2697.2,2485.1,2071.5,1719.4,1343.4,955.6,644.0,341.2,139.0,37.0],total:98275},
1970:{m:[4513.3,4171.0,4006.3,4571.5,5313.0,4517.2,4181.7,4121.6,3665.8,2678.7,2157.1,2042.1,1755.4,1399.2,961.6,531.9,241.4,71.6,17.5],f:[4292.5,3988.3,3852.1,4492.1,5347.3,4571.9,4190.3,4085.3,3674.1,3198.9,2648.4,2382.7,1970.5,1584.7,1172.2,736.3,408.2,158.1,48.4],total:103720},
1975:{m:[5130.2,4586.2,4239.4,4042.5,4566.1,5429.3,4627.2,4214.9,4127.4,3658.5,2618.2,2073.8,1936.9,1572.1,1148.6,688.7,307.9,101.0,21.7],f:[4874.6,4355.6,4046.1,3909.3,4509.2,5369.8,4622.5,4210.9,4100.1,3705.9,3165.8,2601.7,2348.6,1878.3,1428.4,953.0,501.1,208.2,60.0],total:111940},
1980:{m:[4369.7,5146.8,4598.7,4227.3,3964.0,4549.5,5426.4,4598.8,4162.6,4036.5,3549.8,2513.3,1947.4,1745.0,1318.6,849.3,418.0,138.8,33.2],f:[4150.9,4891.5,4366.5,4050.1,3882.5,4497.7,5352.3,4608.7,4180.2,4058.8,3654.4,3103.2,2520.2,2221.8,1705.9,1188.4,676.1,271.3,86.2],total:117060},
1985:{m:[3820.4,4375.0,5149.4,4602.7,4168.2,3950.2,4560.4,5400.8,4554.1,4094.0,3928.2,3410.8,2380.9,1781.7,1504.2,1017.8,542.4,203.4,52.7],f:[3641.3,4159.7,4896.3,4380.6,4035.6,3876.0,4497.0,5341.1,4584.2,4145.5,4007.5,3591.1,3026.2,2412.9,2060.2,1476.2,890.9,400.3,129.1],total:121049},
1990:{m:[3337.7,3835.0,4385.0,5141.5,4487.7,4095.2,3940.2,4541.3,5369.7,4499.2,4012.2,3797.0,3247.6,2202.1,1565.1,1201.4,680.6,276.6,81.6],f:[3172.0,3650.5,4163.5,4893.2,4340.0,3999.3,3868.8,4486.3,5317.2,4543.4,4098.0,3947.9,3513.9,2913.2,2261.0,1823.5,1156.2,558.2,208.3],total:123611},
1995:{m:[3074.2,3354.3,3832.0,4392.0,5049.5,4459.4,4120.2,3951.5,4533.7,5336.0,4428.4,3912.4,3617.0,3002.6,1944.0,1262.0,825.5,362.4,117.3],f:[2927.1,3192.8,3653.1,4175.0,4857.4,4339.2,4015.4,3879.0,4481.7,5293.7,4503.3,4049.6,3865.7,3399.5,2755.3,2029.9,1477.1,775.3,326.0],total:125570},
2000:{m:[3029.7,3090.6,3360.8,3843.1,4318.4,4977.9,4448.1,4106.4,3933.5,4478.2,5222.4,4300.6,3758.5,3365.0,2676.2,1629.4,917.3,478.1,176.7],f:[2885.1,2941.9,3197.3,3658.7,4119.7,4831.4,4345.5,4023.7,3880.8,4453.7,5238.5,4449.5,3991.2,3753.1,3234.0,2527.7,1701.4,1056.4,525.2],total:126926},
2005:{m:[2867.5,3050.1,3094.1,3388.6,3774.0,4219.9,4958.2,4425.3,4085.4,3885.2,4402.8,5100.8,4174.2,3561.5,3053.4,2266.0,1227.8,557.5,256.8],f:[2731.4,2900.1,2941.9,3204.0,3607.3,4094.5,4837.0,4346.8,4027.3,3869.3,4425.5,5192.8,4403.1,3898.9,3607.8,3014.5,2195.5,1297.5,823.8],total:127768},
2010:{m:[2716.7,2866.2,3038.6,3127.2,3327.3,3755.1,4273.3,5002.1,4445.7,4068.6,3847.1,4329.7,4965.2,3953.4,3249.2,2601.3,1705.2,750.2,305.8],f:[2591.5,2731.3,2894.9,2965.8,3197.4,3635.7,4147.5,4861.6,4362.8,4024.0,3852.8,4398.4,5147.1,4318.5,3769.0,3390.9,2671.0,1703.8,1065.4],total:128057},
2015:{m:[2560.7,2724.8,2878.9,3112.4,3122.1,3333.3,3751.1,4268.4,4987.7,4422.4,4029.3,3784.1,4210.0,4723.0,3624.7,2817.0,2015.2,1067.9,408.8],f:[2445.5,2594.3,2741.0,2942.0,2968.6,3199.2,3645.0,4148.9,4858.9,4344.0,3994.9,3817.0,4342.4,5036.2,4161.8,3536.5,3011.0,2088.3,1377.4],total:127095},
2020:{m:[2324.6,2619.9,2755.6,2927.6,3234.0,3279.1,3431.3,3806.0,4298.7,4993.9,4394.4,3966.9,3676.7,3999.3,4336.9,3146.2,2231.8,1324.3,602.4],f:[2216.8,2494.3,2620.5,2778.7,3086.0,3105.0,3282.5,3692.4,4177.6,4874.6,4343.7,3973.2,3765.6,4236.9,4851.6,3918.4,3172.0,2417.7,1788.9],total:126146},
2025:{m:[2025.5,2327.1,2628.3,2784.8,3054.5,3323.7,3299.2,3425.2,3790.6,4272.2,4939.9,4314.1,3849.9,3502.2,3692.3,3822.7,2524.6,1499.1,806.5],f:[1927.0,2221.1,2503.5,2657.0,2916.7,3147.9,3119.5,3284.4,3691.8,4167.7,4844.6,4300.6,3916.8,3688.0,4099.8,4597.5,3528.7,2562.1,2205.5],total:123262},
2030:{m:[1980.5,2030.1,2336.8,2659.4,2940.0,3190.5,3362.0,3299.5,3412.3,3768.6,4227.9,4854.2,4194.4,3678.5,3252.0,3273.0,3132.9,1732.3,976.7],f:[1884.0,1933.7,2231.9,2542.1,2830.3,3015.0,3175.7,3126.6,3287.4,3685.9,4143.6,4798.9,4242.5,3841.1,3577.5,3895.8,4189.7,2893.7,2518.7],total:120116},
2035:{m:[1963.6,1985.2,2039.4,2367.9,2815.7,3076.6,3229.7,3362.7,3287.9,3393.7,3731.8,4157.9,4726.0,4019.0,3430.5,2903.3,2695.5,2217.1,1170.6],f:[1868.0,1890.8,1944.1,2270.7,2716.3,2929.3,3043.6,3182.9,3130.3,3283.4,3666.0,4106.0,4737.3,4165.5,3733.4,3412.3,3562.1,3506.7,2916.1],total:116639},
2040:{m:[1885.9,1968.5,1994.4,2070.8,2526.0,2952.8,3116.6,3231.3,3351.6,3271.1,3362.1,3673.2,4052.8,4536.5,3762.4,3081.2,2419.1,1921.3,1538.7],f:[1794.1,1874.9,1901.3,1983.3,2446.7,2815.6,2958.4,3051.4,3186.9,3127.2,3266.5,3634.0,4055.1,4655.2,4055.9,3572.0,3142.3,2997.0,3603.4],total:112837},
2045:{m:[1779.5,1890.8,1977.7,2025.2,2217.6,2653.6,2992.3,3118.9,3221.2,3335.4,3242.5,3311.7,3585.0,3897.3,4257.0,3397.3,2592.3,1760.0,1526.4],f:[1692.9,1800.9,1885.2,1939.6,2147.5,2539.5,2844.4,2966.5,3055.6,3184.2,3112.2,3239.1,3590.9,3987.8,4537.8,3890.8,3308.5,2679.5,3616.7],total:108801},
2050:{m:[1646.2,1784.2,1899.6,2008.4,2168.6,2330.7,2688.9,2994.8,3109.7,3206.5,3307.6,3196.4,3235.8,3454.3,3666.3,3855.6,2882.3,1918.5,1450.3],f:[1566.0,1699.3,1810.8,1923.5,2100.4,2230.0,2565.4,2852.3,2970.8,3053.4,3169.5,3087.2,3202.2,3534.2,3891.8,4360.1,3621.6,2852.5,3390.7],total:104686},
2055:{m:[1504.5,1650.5,1792.5,1929.3,2151.0,2280.3,2362.3,2691.2,2986.4,3096.2,3180.9,3262.5,3126.6,3122.7,3258.9,3331.8,3285.8,2164.9,1559.6],f:[1431.2,1572.0,1708.7,1847.9,2083.2,2181.9,2253.1,2572.7,2856.7,2969.0,3039.9,3145.1,3053.6,3153.8,3453.4,3745.7,4069.5,3152.1,3481.1],total:100508},
2060:{m:[1407.1,1508.5,1658.3,1820.7,2066.6,2261.6,2311.6,2364.6,2684.0,2974.1,3072.7,3139.3,3194.1,3022.4,2952.6,2973.4,2854.0,2485.9,1794.2],f:[1338.5,1436.8,1580.7,1743.8,2001.4,2163.9,2204.9,2259.7,2576.8,2855.3,2956.5,3017.2,3112.0,3009.4,3084.7,3330.1,3506.6,3559.6,3864.6],total:96148},
2065:{m:[1355.5,1410.8,1515.6,1684.5,1950.5,2172.8,2292.8,2314.3,2358.6,2673.4,2952.4,3034.1,3075.8,3091.6,2864.9,2702.3,2563.0,2178.1,2099.6],f:[1289.4,1343.7,1444.7,1613.3,1888.8,2078.8,2186.6,2211.4,2263.4,2575.7,2843.7,2935.2,2986.5,3068.6,2946.6,2979.0,3128.4,3084.8,4427.6],total:91587},
2070:{m:[1308.3,1359.1,1417.5,1539.5,1804.8,2050.7,2202.8,2295.5,2308.6,2349.7,2654.5,2916.7,2975.1,2980.3,2935.8,2631.2,2340.4,1978.1,2047.5],f:[1244.5,1294.5,1351.1,1474.5,1747.6,1961.8,2100.7,2193.2,2215.3,2262.7,2565.5,2823.9,2906.4,2946.3,3007.0,2850.2,2805.9,2771.2,4377.5],total:86996},
};

const margin = {top: 20, right: 60, bottom: 40, left: 60};
const W = Math.min(800, window.innerWidth - 40);
const H = 480;
const chartW = W - margin.left - margin.right;
const chartH = H - margin.top - margin.bottom;
const halfW = chartW / 2 - 20;

const svg = d3.select("#chart").append("svg")
  .attr("width", W).attr("height", H)
  .append("g").attr("transform", `translate(${margin.left},${margin.top})`);

const maxPop = 6500;
const xScaleM = d3.scaleLinear().domain([0, maxPop]).range([halfW, 0]);
const xScaleF = d3.scaleLinear().domain([0, maxPop]).range([0, halfW]);
const yScale = d3.scaleBand().domain(d3.range(19)).range([chartH, 0]).padding(0.12);

const centerX = chartW / 2;

const xAxisM = d3.axisBottom(xScaleM).ticks(5).tickFormat(d => d === 0 ? "" : (d/1000).toFixed(1)+"M");
const xAxisF = d3.axisBottom(xScaleF).ticks(5).tickFormat(d => d === 0 ? "" : (d/1000).toFixed(1)+"M");

svg.append("g").attr("class","axis").attr("transform", `translate(0,${chartH})`).call(xAxisM);
svg.append("g").attr("class","axis").attr("transform", `translate(${centerX + 20},${chartH})`).call(xAxisF);

svg.selectAll(".age-label")
  .data(ageLabels).join("text")
  .attr("class","age-label")
  .attr("x", centerX + 10).attr("y", (d,i) => yScale(i) + yScale.bandwidth()/2)
  .attr("text-anchor","middle").attr("dominant-baseline","central")
  .text(d => d);

const maleGroup = svg.append("g");
const femaleGroup = svg.append("g");

function updateChart(yearIdx) {
  const year = years[yearIdx];
  const d = data[year];

  document.getElementById("yearDisplay").textContent = year;
  document.getElementById("yearDisplay").className = year > 2020 ? "year-display future" : "year-display";

  maleGroup.selectAll("rect").data(d.m)
    .join("rect")
    .transition().duration(300)
    .attr("x", v => xScaleM(v))
    .attr("y", (v,i) => yScale(i))
    .attr("width", v => halfW - xScaleM(v))
    .attr("height", yScale.bandwidth())
    .attr("fill", "#4a90d9")
    .attr("rx", 2)
    .attr("opacity", 0.82);

  femaleGroup.selectAll("rect").data(d.f)
    .join("rect")
    .transition().duration(300)
    .attr("x", centerX + 20)
    .attr("y", (v,i) => yScale(i))
    .attr("width", v => xScaleF(v))
    .attr("height", yScale.bandwidth())
    .attr("fill", "#d04a5a")
    .attr("rx", 2)
    .attr("opacity", 0.82);

  const totalM = d.m.reduce((a,b)=>a+b,0);
  const totalF = d.f.reduce((a,b)=>a+b,0);
  const elderly = d.m.slice(13).reduce((a,b)=>a+b,0) + d.f.slice(13).reduce((a,b)=>a+b,0);
  const young = d.m.slice(0,3).reduce((a,b)=>a+b,0) + d.f.slice(0,3).reduce((a,b)=>a+b,0);
  const elderlyPct = (elderly / d.total * 100).toFixed(1);
  const youngPct = (young / d.total * 100).toFixed(1);

  document.getElementById("stats").innerHTML = `
    <div class="stat"><div class="stat-value">${(d.total/1000).toFixed(1)}M</div><div class="stat-label">Total Population</div></div>
    <div class="stat"><div class="stat-value">${elderlyPct}%</div><div class="stat-label">Aged 65+ (Elderly)</div></div>
    <div class="stat"><div class="stat-value">${youngPct}%</div><div class="stat-label">Aged 0–14 (Youth)</div></div>
    <div class="stat"><div class="stat-value" style="color:${year > 2020 ? "#d03025" : "#1a1a1a"}">${year > 2020 ? "Projected" : "Census"}</div><div class="stat-label">Data Type</div></div>
  `;
}

const slider = document.getElementById("yearSlider");
slider.addEventListener("input", () => updateChart(+slider.value));

let playing = false;
let playInterval;
const playBtn = document.getElementById("playBtn");

playBtn.addEventListener("click", () => {
  if (playing) {
    clearInterval(playInterval);
    playBtn.textContent = "▶ Play";
    playing = false;
  } else {
    if (+slider.value >= 21) slider.value = 0;
    playing = true;
    playBtn.textContent = "⏸ Pause";
    playInterval = setInterval(() => {
      let v = +slider.value;
      if (v >= 21) {
        clearInterval(playInterval);
        playBtn.textContent = "▶ Play";
        playing = false;
        return;
      }
      slider.value = v + 1;
      updateChart(v + 1);
    }, 800);
  }
});

updateChart(0);
</script>

</body>
</html>
